<div class="container">
	<form class="form-inline" onsubmit="document.location.hash=DB.form2param('.query .row').join('');return false;">
		<h3>Critere de recherche</h3>
		<div class="query"></div>
		<button type="button" class="btn btn-link" onclick="$('.query .row:first').clone().appendTo('.query');"><span class="glyphicon glyphicon-plus"></span> Ajouter un critère supplémentaire</button>
		<button type="submit" class="btn btn-link"><span class="glyphicon glyphicon-search"></span> Rechercher</button>
		<button type="button" class="btn btn-link" onclick="Ressource.edit()"><span class="glyphicon glyphicon-plus"></span> Créer...</button>
	</form>
	<div class="table-overflow" id="results_list"></div>
</div>

<script src="/js/Ressource.js"></script>
<script>
//init
var bd_table='ressource';
DB('option',bd_table).success(DB.toSearchForm.bind({async:false,target:'.query',hash:document.location.hash}));
//deamons
(window.onhashchange=function(ev){//search when query changed/init
	DB.toSearchForm.call({target:'.query',hash:URL(ev.newURL).hash});//update the form
	if(URL(ev.newURL).hash.length>1)//no more hash => do nothing
		DB('find',bd_table+'/'+URL(ev.newURL).hash.slice(1)).success(Ressource.list());//do the search
})({newURL:document.location.href});//trigger to take into account initial hash

</script>